{% extends "layout.html" %}
{% load static %}
{% block head %}
    <link rel="stylesheet" href="{% static 'library/library.css' %}">
{% endblock head %}
{% block body %}
    <div class="library-main">
        <div class="filter-part">
            <h1>Filters</h1>
            <form method="get" action="{% url 'library' %}" id="filter-form">
                <div class="genre">
                    <label for="genre" class="first-label">Choose a genre:</label>
                    <select id="genre" name="genre">
                        <option value="" disabled selected>Select a genre</option>
                        {% for genre in genres %}
                            <option value="{{ genre.name }}"
                                    {% if request.GET.genre == genre.name %}selected{% endif %}>
                                {{ genre.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="availability">
                    <label class="first-label">Availability:</label>
                    <label>
                        <input type="radio"
                               name="available"
                               value="all"
                               {% if request.GET.available == 'all' %}checked{% endif %}>
                        All
                    </label>
                    <label>
                        <input type="radio"
                               name="available"
                               value="true"
                               {% if request.GET.available == 'true' %}checked{% endif %}>
                        Available
                    </label>
                    <label>
                        <input type="radio"
                               name="available"
                               value="false"
                               {% if request.GET.available == 'false' %}checked{% endif %}>
                        Unavailable
                    </label>
                </div>
                <div class="author">
                    <label class="first-label">Author:</label>
                    <p class="dropdown-btn">
                        Select Author <span>â–¼</span>
                    </p>
                    <div class="dropdown-content">
                        {% for author in authors %}
                            <label>
                                <input type="checkbox"
                                       name="author"
                                       value="{{ author.name }}"
                                       {% if author.name in authors_selected %}checked{% endif %}>
                                {{ author.name }}
                            </label>
                        {% endfor %}
                    </div>
                </div>
                <div class="filter-buttons">
                    <a href="?" class="btn-clean-filters">Clear Filters</a>
                    <button type="submit">Search</button>
                </div>
            </form>
        </div>
        <div class="vertical-line"></div>
        <div class="library-part">
            <div class="library-top-bar">
                {% if message %}<p class="error-message">{{ message }}</p>{% endif %}
                {% if user.is_staff %}
                    <div class="new-book-button-div">
                        <button class="new-book-button">New Book</button>
                    </div>
                {% endif %}
            </div>
            {% if user.is_staff %}
                <form method="post"
                      class="form-container add-book-form hidden"
                      autocomplete="off">
                    {% csrf_token %}
                    <h1 class="form-title">Add New Book To Library</h1>
                    {{ form.non_field_errors }}
                    <div class="container-form-item">
                        {{ form.title }}
                        {{ form.title.label_tag }}
                        {{ form.title.errors }}
                    </div>
                    <div class="container-form-item">
                        {{ form.description }}
                        {{ form.description.label_tag }}
                        {{ form.description.errors }}
                    </div>
                    <div class="container-form-item">
                        {{ form.author }}
                        {{ form.author.label_tag }}
                        {{ form.author.errors }}
                    </div>
                    <div class="container-form-item">
                        {{ form.availability }}
                        {{ form.availability.label_tag }}
                        {{ form.availability.errors }}
                    </div>
                    <div class="container-form-item">
                        {{ form.publication_year }}
                        {{ form.publication_year.label_tag }}
                        {{ form.publication_year.errors }}
                    </div>
                    <div class="container-form-item">
                        {{ form.cover_image }}
                        {{ form.cover_image.label_tag }}
                        {{ form.cover_image.errors }}
                    </div>
                    <div class="container-form-item">
                        {{ form.genre }}
                        {{ form.genre.label_tag }}
                        {{ form.genre.errors }}
                    </div>
                    <button type="submit" id="add-book-button">Add Book</button>
                </form>
            {% endif %}
            <div class="books">
                {% for book in books %}
                    <div class="book-item">
                        <a href="{% url 'book_page' book.id %}">
                            <img src="{{ book.cover_image }}"
                                 width="160"
                                 height="240"
                                 alt="cover image">
                            <p id="title">{{ book.title }}</p>
                        </a>
                        <p id="author">{{ book.author }}</p>
                    </div>
                {% endfor %}
            </div>
            <div class="pagination">
                {% if books.has_previous %}<a href="?page={{ books.previous_page_number }}&{{ query_params }}">&laquo;</a>{% endif %}
                {% for num in page_range %}
                    {% if books.number == num %}
                        <a href="?page={{ num }}&{{ query_params }}" class="active">{{ num }}</a>
                    {% else %}
                        <a href="?page={{ num }}&{{ query_params }}">{{ num }}</a>
                    {% endif %}
                {% endfor %}
                {% if books.has_next %}<a href="?page={{ books.next_page_number }}&{{ query_params }}">&raquo;</a>{% endif %}
            </div>
        </div>
    </div>
{% endblock body %}
{% block script %}
    <script src="{% static 'library/library.js' %}"></script>
{% endblock script %}
